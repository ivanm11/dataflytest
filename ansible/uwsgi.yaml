- name: install libxml2-dev for uwsgi compilation
  action: apt pkg=libxml2-dev
- name: install uwsgi
  action: pip name=uwsgi
- template: src=$starter/ansible/templates/uwsgi.conf
            dest=/etc/init/
- action: file name=/etc/uwsgi/vassals state=directory
               owner=www-data group=www-data
- action: command touch /var/log/uwsgi.log
- action: file name=/var/log/uwsgi.log state=file
               owner=www-data group=www-data
- action: file name=/var/log/uwsgi state=directory
               owner=www-data group=www-data
- action: command touch /var/log/uwsgi/emperor.log
- action: file name=/var/log/uwsgi/emperor.log state=file
               owner=www-data group=www-data
- name: copy production ini
  template: src=$project_root/server/uwsgi.ini
            dest=/etc/uwsgi/vassals/${project}.ini
- name: copy staging ini
  template: src=$project_root/server/uwsgi_staging.ini
            dest=/etc/uwsgi/vassals/${project}_staging.ini
- name: start uWSGI
  action: service name=uwsgi state=started